---
globs: *.ts,*.tsx
---

# ðŸ“‹ Forms

## Zod by default

- use `zod/v4` for a schema definition
- use `useForm` from `react-hook-form`
- utilize `formState: FormState` as much as possible (e.g. disable submit button on isSubmitting)

## Example

```typescript
import { z } from "zod/v4"; // âœ… Correct: import zod for a schema

// âœ… Correct: use zod outside of the component
export const formSchema = z.object({
  shouldPostpone: z.boolean(), // âœ… Correct: custom form schema
  message: z.string(), // âœ… Correct: custom form schema
});

// âœ… Correct: infer schema values
type FormValues = z.infer<typeof formSchema>;

// âœ… Correct: create initial values hook
function useFormInitialValues() {
  return useMemo(() => ({  // âœ… Correct: memoize the initial values return
    shouldPostpone: false,
    message: '',
  }), []);
}

// âœ… Correct: create onSubmit handler hook
function useFormSubmit() {
  // âœ… Correct: memoize the the submit callback
  return useCallback((data: ChangePasswordFormData) => {
    // TODO: Implement password change API call
    alert(JSON.stringify(data));
  }, [])
}

...
// Component render function
const initialValues = useFormInitialValues();
const onSubmit = useFormSubmit();

const {
  control,
  handleSubmit,
  reset,
  formState: { errors },
} = useForm<FormValues>({
  resolver: zodResolver(formSchema), // âœ… Correct: create resolver for a schema
  defaultValues: initialValues,
});
```

### Using with JSX

```typescript
function CustomComponent() {
  const { handleSubmit } = useForm<TFormValues>({
    [...form config]
  })

  function onSubmit(data) { // âœ… Correct: create submit handler
    console.log(data)
  }

  return (
    <>
      <Box component="form onSubmit={handleSubmit(onSubmit)}"> // âœ… Correct: always pass component="form" for a mui/components
        [...fields]
      </Box>
      <form onSubmit={handleSubmit(onSubmit)}> //  âœ… Correct: `onSubmit` handler for a form
        [...fields]
      </form>
    </>
  )
}
```

### Reinitialize on values changed (disabled by default)

```typescript
// âœ… Correct: add initialValues into dependency
useEffect(() => {
  reset(initialValues);
}, [initialValues]);
```

### Submit on mount

```typescript
// âœ… Correct: subscribe for a whole form update with `watch` subscription
useEffect(() => {
  const unsubscribe = subscribe({
    formState: {
      values: true,
    },
    callback: () => {
      formRef.current?.requestSubmit(); // âœ… Correct: Submit form via ref on values change
    },
  });

  return () => unsubscribe();
}, [subscribe, onSubmit]);

...
<form ref={formRef} ...
```

## Reset on successful submit

```typescript
const {
  // âœ… Correct: get isSubmitSuccessful from the
  formState: { errors, isSubmitSuccessful },
} = useForm<FormValues>({
  // ...form config
});

// âœ… Correct: reset form after successful submission
useEffect(() => {
  if (isSubmitSuccessful) {
    reset();
  }
}, [isSubmitSuccessful, reset]);
```
